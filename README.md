# ðŸ“¦ Unity Package Template

![Build Status](https://github.com/FilippoGurioli-master-thesis/unity-package-template/actions/workflows/main.yml/badge.svg)
![Release](https://img.shields.io/github/v/release/FilippoGurioli-master-thesis/unity-package-template)
![License](https://img.shields.io/github/license/FilippoGurioli-master-thesis/unity-package-template)

A template for Unity package projects. It contains the cutting edge features regarding development automation providing an easy way to customize and start up quickly.

It features:

- Conventional commit enforcements (through [husky](https://typicode.github.io/husky/) packages)
- Fast static checks at commit time
  - formatting of C# code
  - `.meta` files validation
  - `.unity` files validation
- Semantic release (through [semantic-release](https://semantic-release.gitbook.io/semantic-release/) package)
- Automatic dependency updates (through [renovate](https://docs.renovatebot.com/))
- Signing artifact
- Quality Assurance gateway (through [SonarQube](https://www.sonarsource.com/))
- Docstring-driven documentation generation (through [docfx](https://dotnet.github.io/docfx/))
- Well structured issues and PRs templates
- A production ready CI/CD pipeline
  - Build the project to the main 3 OSes
  - Execute tests
  - Pass through QA gate
  - Sign the artifact
  - Release
  - Documentation generation and deploy to GitHub Pages

To correctly use this project as a template it must be launched the `init` script. This script does the following things:

- configures the unity package unique name
  - asks for domain, company and package names, defaulting to reasonable values
- configures the base namespace of the project
- configures the license under which the package should be
- configures the description of the package
- asks and uploads all secrets needed in CI to work properly
  - `UNITY_LICENSE`: path to the unity license
  - `UNITY_EMAIL`: mail used in unity
  - `UNITY_PASSWORD`: password used for the unity email
  - `SONAR_HOST_URL`: url hosting the SonarQube instance
  - `SONAR_TOKEN`: token used to interact with the sonar host
  - `GPG_KEY_ID`: an ephemeral gpg key used to sign the artifact (Warning: this key is generated during the script, nothing will be asked to the user)
  - `GPG_PRIVATE_KEY`: the private key used to sign the artifact (Warning: this key is generated during the script, nothing will be asked to the user)
- replaces all occurrences of template values in the project with values inserted by the user
  - `__DOMAIN__`
  - `__COMPANY__`
  - `__PACKAGE__`
  - `__NAMESPACE__`
  - `__NAME__`
  - `__DESCRIPTION__`
  - `__GIT_USER__`
  - `__GIT_MAIL__`
- installs npm and dotnet dependencies
- boots the project with unity batch mode
- installs git hooks
- removes `.template` file
- removes the `init` script itself
- configures [unity smart merge](https://docs.unity3d.com/6000.3/Documentation/Manual/SmartMerge.html)
- opens the unity editor inside the sandbox
- creates the develop branch
- set branches and tags basic protection rules
- commits all changes made until now
- set the tag of that commit to `0.0.0`

## Prerequisites

As of now the project has strong assumptions on the environment from within it is executed:

- Node.js installed and at least at version `v25.2.1` with a compatible npm package
- Unity 6000 installed
  - Therefore the .NET SDK at `v8`
- GitHub CLI installed and at least at version `GitHub CLI 2.83.2`

## Project Structure

- **`.config/`**: .NET dependencies folder.
- **`.github/`**: CI/CD pipelines and issues and PRs templates.
- **`Sandbox.__NAMESPACE__/`**: A local Unity project to test your package in isolation.
- **`.automation/`**: A bunch of scripts useful for automation.
- **`.husky/`**: Configuration folder for [Husky](https://typicode.github.io/husky/).
- **`__NAMESPACE__/`**: The actual package source code following the [UMP folder structure](https://docs.unity3d.com/6000.3/Documentation/Manual/cus-layout.html).
- **`docs/`**: documentation related to template.
- **`.cshariperrc.json`**: configuration file for C# formatting tool.
- **`.template`**: Presence of this file triggers "Template Mode" in CI. Its removal would cause to start a real package.
- **`CHANGELOG.md`**: the changelog (generated by semantic-release)
- **`LICENSE`**: the license file
- **`README.md`**: this file
- **`init.sh`**: bootstrap script for POSIX-compliant environments.
- **`init.ps1`**: bootstrap script for Windows.
- **`package.json`**: Node dependencies file.
- **`release.config.js`**: configuration file for semantic-release tool.
- **`renovate.json`**: configuration file for automatic deps update tool.
- **`snoar-project.properties`**: configuration file for QA tool.

## Usage

1. Use this project as template pressing the [![use this template](https://user-images.githubusercontent.com/9135028/198753285-3d3c9601-0711-43c7-a8f2-d40ec42393a2.png)](https://github.com/FilippoGurioli-master-thesis/unity-package-template/generate) button.
2. Run `init` script to start your unity package development.

```bash
bash ./init.sh
```

or (in Windows)

```pwsh
.\init.ps1
```

3. Enjoy your production ready automated environment.
